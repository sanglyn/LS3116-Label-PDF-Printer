<!-- Ver 0.6 -->

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Label PDF Printer</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- pdf-lib CDN -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <div class="app-shell">
    <!-- 헤더 -->
    <header class="app-header">
      <div class="app-title">
        <!-- 로고 / 버전 박스 -->
        <div class="app-logo">
          <span class="logo-box">
            Label PDF Printer <span class="app-version">v0.5</span>
          </span>
        </div>
        <!-- 서브 타이틀 -->
        <div class="app-subtitle">
          Formtec LS-3116 / LS-3114 A4 Portrait Label Layout Helper
        </div>
      </div>

      <div class="app-header-actions">
        <button id="helpBtn" type="button" class="icon-button" title="도움말">?</button>
      </div>
    </header>

    <!-- 메인 -->
    <main class="app-main">
      <!-- 1단계: 라벨 용지 선택 -->
      <section class="card" id="cardLayoutSelect">
        <div class="card-header">
          <div>
            <h1>1. 라벨 용지 선택</h1>
            <span class="card-caption">
              사용할 Formtec 라벨 용지(2×3 / 2×4)를 먼저 선택해주세요.
            </span>
          </div>
          <button type="button" class="card-toggle-btn" data-target="cardLayoutSelect">
            <span class="toggle-icon">▼</span>
          </button>
        </div>
        <div class="card-body">

        <div class="layout-picker-grid">
          <!-- LS3116 -->
          <label class="layout-card" data-layout="LS3116">
            <input type="radio" name="layoutSelect" value="LS3116" checked />
            <div class="layout-card-body">
              <div class="layout-card-title">LS-3116</div>
              <div class="layout-card-mini ls3116-mini">
                <div class="mini-row"><span class="mini-box"></span><span class="mini-box"></span></div>
                <div class="mini-row"><span class="mini-box"></span><span class="mini-box"></span></div>
                <div class="mini-row"><span class="mini-box"></span><span class="mini-box"></span></div>
              </div>
              <div class="layout-card-info">
                2 × 3 Layout<br>
                Label: 99.1 × 93.1 mm<br>
                총 6칸
              </div>
            </div>
          </label>

          <!-- LS3114 -->
          <label class="layout-card" data-layout="LS3114">
            <input type="radio" name="layoutSelect" value="LS3114" />
            <div class="layout-card-body">
              <div class="layout-card-title">LS-3114</div>
              <div class="layout-card-mini ls3114-mini">
                <div class="mini-row"><span class="mini-box"></span><span class="mini-box"></span></div>
                <div class="mini-row"><span class="mini-box"></span><span class="mini-box"></span></div>
                <div class="mini-row"><span class="mini-box"></span><span class="mini-box"></span></div>
                <div class="mini-row"><span class="mini-box"></span><span class="mini-box"></span></div>
              </div>
              <div class="layout-card-info">
                2 × 4 Layout<br>
                Label: 99.1 × 67.7 mm<br>
                총 8칸
              </div>
            </div>
          </label>
        </div>


        </div>
      </section>

      <!-- 2단계: PDF 업로드 -->
      <section class="card" id="cardUpload">
        <div class="card-header">
          <div>
            <h2>2. PDF 업로드</h2>
            <span class="card-caption">
              개별 패킹 라벨 PDF 또는 복수 페이지 PDF(페이지별 자동 분할)를 업로드하세요.
            </span>
          </div>
          <button type="button" class="card-toggle-btn" data-target="cardUpload">
            <span class="toggle-icon">▼</span>
          </button>
        </div>
        <div class="card-body">

        <div id="dropZone" class="drop-zone">
          <div class="drop-zone-inner">
            <div class="drop-zone-icon">📄</div>
            <div class="drop-zone-text-main">PDF를 드래그하거나 클릭해서 업로드</div>
            <div class="drop-zone-text-sub">
              배송 라벨, 인보이스 등 여러 개의 PDF를 한 번에 올려도 됩니다.
              (페이지 단위로 자동 분리)
            </div>
          </div>
        </div>
        <input
          id="pdfFiles"
          type="file"
          accept="application/pdf"
          multiple
          style="display:none;"
        />

        <div class="files-toolbar">
          <span class="files-info" id="filesInfoText">업로드된 파일이 없습니다.</span>
          <div class="files-toolbar-right">
            <button id="toggleFilesViewBtn" type="button" class="btn-text" style="display:none;">
              전체 목록 보기
            </button>
            <button id="clearAllBtn" type="button" class="btn-text">
              모두 삭제
            </button>
          </div>
        </div>

        <table id="filesTable" class="files-table" style="display:none;">
          <thead>
            <tr>
              <th style="width:40px;">#</th>
              <th>파일명 (페이지 단위)</th>
              <th style="width:150px;">배정 위치</th>
              <th style="width:70px;">삭제</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        </div>
      </section>

      <!-- 3단계: 라벨 배치 -->
      <section class="card" id="cardPlacement">
        <div class="card-header">
          <div>
            <h2>3. 라벨 배치</h2>
            <span class="card-caption">
              선택한 레이아웃(2×3 / 2×4)에 페이지별로 라벨을 배치합니다. (드래그 & 드롭, 클릭 이동)
            </span>
          </div>
          <div style="display: flex; gap: 8px; align-items: center;">
            <button type="button" class="card-toggle-btn" data-target="cardPlacement">
              <span class="toggle-icon">▼</span>
            </button>
            <button id="layoutTipBtn" type="button" class="icon-button small" title="배치 팁">
              ?
            </button>
          </div>
        </div>
        <div class="card-body">

        <!-- 페이지 스트립 네비게이터 -->
        <div class="layout-strip-header">
          <div class="layout-title-group">
            <div class="layout-title-main">라벨 페이지 보드</div>
            <div class="layout-title-sub">
              화면에 최대 4개의 페이지 보드를 보여줍니다. 각 칸에 PDF를 배치하면 LS-3116/LS-3114
              용지에 맞게 인쇄용 PDF로 합쳐집니다.
            </div>
          </div>
          <div class="page-strip-nav">
            <button id="pageStripPrev" class="icon-button small" type="button" title="이전 페이지 그룹">
              ◀
            </button>
            <span id="pageStripRange" class="page-strip-range">1–1 / 1</span>
            <button id="pageStripNext" class="icon-button small" type="button" title="다음 페이지 그룹">
              ▶
            </button>
          </div>
        </div>

        <div class="page-strip-wrapper">
          <div id="pageStrip" class="page-strip"></div>

          <button
            id="addPageBtn"
            class="page-add-button"
            type="button"
            title="페이지 추가"
          >
            +
          </button>
        </div>

        <div id="selectedFileInfo" class="selected-file-label">
          선택된 파일: 없음 (페이지 보드에서 파일이 들어간 슬롯을 클릭해서 선택)
        </div>
        </div>
      </section>

      <!-- 오프셋 & PDF 생성 -->
      <section class="card" id="cardOffset">
        <div class="card-header">
          <div>
            <h2>4. 오프셋 & PDF 생성</h2>
            <span class="card-caption">
              프리셋으로 기본값을 맞추고, 필요하면 세부 오프셋과 스케일 모드를 조정한 뒤 PDF를 생성하세요.
            </span>
          </div>
          <button type="button" class="card-toggle-btn" data-target="cardOffset">
            <span class="toggle-icon">▼</span>
          </button>
        </div>
        <div class="card-body">

        <!-- 스케일 모드 (위로 이동됨) -->
        <div class="offset-section" style="margin-bottom: 16px;">
          <div class="offset-section-title">스케일 모드</div>
          <div class="offset-section-grid">
            <div class="field field-full">
              <label class="radio-label">
                <input type="radio" name="scaleMode" value="original" checked />
                <span>원본 크기 유지 (텍스트/바코드 크기 우선)</span>
              </label>
            </div>
            <div class="field field-full">
              <label class="radio-label">
                <input type="radio" name="scaleMode" value="fitWidth" />
                <span>라벨 가로폭에 맞게 비율 유지</span>
              </label>
            </div>
            <div class="field field-full">
              <label class="checkbox-label">
                <input type="checkbox" id="clipToSlot" />
                <span>슬롯 밖으로 튀어나가지 않도록 자동 축소 (안전 모드)</span>
              </label>
            </div>
            <div class="field field-full">
              <label class="checkbox-label">
                <input type="checkbox" id="clipAtBoundary" checked />
                <span>슬롯 경계에서 자르기 (권장)</span>
              </label>
              <span class="field-hint" style="margin-left: 20px; font-size: 11px; color: #888;">
                체크: 슬롯 밖 내용 제거 / 해제: 슬롯 밖으로 출력 허용
              </span>
            </div>
          </div>
        </div>

        <!-- 프리셋 / 아코디언 -->
        <div class="offset-row">
          <div class="offset-row-left">
            <label class="field-label">오프셋 프리셋</label>
            <div class="preset-buttons">
              <button id="presetNone" type="button" class="btn-preset">
                프리셋 없음
              </button>
              <button id="presetTracx" type="button" class="btn-preset">
                트랙스로지스
              </button>
              <button id="presetShopee" type="button" class="btn-preset">
                쇼피 SLS
              </button>
            </div>
            <!-- Preset Status Text Removed -->
          </div>
          <div class="offset-row-right">
            <button id="toggleOffsetDetails" type="button" class="btn-offset-toggle">
              세부 오프셋 (고급) 펼치기 ▸
            </button>
          </div>
        </div>

        <!-- 세부 오프셋 (아코디언) -->
        <div id="offsetDetails" class="offset-details" style="display:none;">
          
          <!-- 2열 그리드로 전체 오프셋 & 칸 기본 오프셋 배치 -->
          <div class="offset-grid-2col">
            <!-- 전체 오프셋 -->
            <div class="offset-section">
              <div class="offset-section-title">전체 오프셋 (A4 기준, mm)</div>
              <div class="offset-section-grid-simple">
                <div class="field">
                  <label for="sheetOffsetX" class="field-label">전체 X (가로)</label>
                  <input type="number" id="sheetOffsetX" class="input" step="0.1" value="0" />
                  <span class="field-hint">+ 오른쪽 / - 왼쪽</span>
                </div>
                <div class="field">
                  <label for="sheetOffsetY" class="field-label">전체 Y (세로)</label>
                  <input type="number" id="sheetOffsetY" class="input" step="0.1" value="0" />
                  <span class="field-hint">+ 위쪽 / - 아래쪽</span>
                </div>
              </div>
            </div>

            <!-- 칸 기본 오프셋 -->
            <div class="offset-section">
              <div class="offset-section-title">칸 기본 오프셋 & 축소</div>
              <div class="offset-section-grid-simple">
                <div class="field">
                  <label for="bulkOffsetX" class="field-label">X (mm)</label>
                  <input type="number" id="bulkOffsetX" class="input" step="0.1" value="0" />
                  <span class="field-hint">+ 오른쪽 / - 왼쪽</span>
                </div>
                <div class="field">
                  <label for="bulkOffsetY" class="field-label">Y (mm)</label>
                  <input type="number" id="bulkOffsetY" class="input" step="0.1" value="0" />
                  <span class="field-hint">+ 위쪽 / - 아래쪽</span>
                </div>
                <div class="field">
                  <label for="bulkScale" class="field-label">축소 (%)</label>
                  <input type="number" id="bulkScale" class="input" step="1" value="95" />
                  <span class="field-hint">권장: 50 ~ 120</span>
                </div>
                <div class="field field-full">
                  <button type="button" id="applyBulkOffset" class="btn-primary small">
                    모든 칸에 X/Y/축소 적용
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- 칸별 오프셋 -->
          <div class="offset-section">
            <div class="offset-section-title">칸별 오프셋 & 축소</div>
            <span class="card-caption">
              (예: 복수 라벨 반영 시 오른쪽 라벨 X:-100, 아래 라벨 Y:95 등으로 미세 조정)
            </span>
            <div id="slotOffsetContainer" class="slot-offset-grid">
              <!-- JS에서 동적으로 생성 -->
            </div>
          </div>
        </div>

        <!-- 생성 -->
        <div class="generate-row">
          <button id="generateBtn" disabled class="btn-primary">
            PDF 생성
          </button>
          <a
            id="downloadLink"
            href="#"
            download="LS-labels.pdf"
            class="btn-outline"
            style="display:none;"
          >
            생성된 PDF 다운로드
          </a>
        </div>
        
        <!-- 가이드 레이아웃 표시 (아래로 이동됨) -->
        <div class="guide-option" style="margin-top: 12px;">
          <label class="checkbox-label">
            <input type="checkbox" id="showGuide" />
            <span>가이드 레이아웃 표시 (라벨 테두리)</span>
          </label>
        </div>

        <div id="msg"></div>
        </div>
      </section>

      <!-- 미리보기 -->
      <section class="card" id="cardPreview">
        <div class="card-header">
          <div>
            <h2>5. 미리보기</h2>
            <span class="card-caption">생성된 A4 PDF를 화면에서 미리 확인하세요.</span>
          </div>
          <button type="button" class="card-toggle-btn" data-target="cardPreview">
            <span class="toggle-icon">▼</span>
          </button>
        </div>
        <div class="card-body">
          <div class="preview-wrapper" style="height:1200px;">
            <iframe id="pdfPreview" class="preview-frame"></iframe>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- 도움말 모달 -->
  <div id="helpModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>도움말 & 배치 팁</h3>
        <button id="helpClose" class="icon-button small">✕</button>
      </div>
      <div class="modal-body">
        <p>
          이 도구는 Formtec LS-3116(2×3), LS-3114(2×4) 등 라벨 용지에
          개별 PDF 패킹라벨을 정확한 위치로 배치하기 위한 툴입니다.
        </p>
        <ul>
          <li>1단계에서 라벨 용지를 선택한 다음, 2단계에서 PDF를 업로드합니다.</li>
          <li>여러 페이지로 된 PDF도 페이지 단위로 자동 분리되어 슬롯에 배정됩니다.</li>
          <li>라벨 배치 보드에서 칸을 드래그 & 드롭하여 같은 페이지 또는 다른 페이지로 이동/교환할 수 있습니다.</li>
          <li>채워진 칸끼리의 교환은 드래그 & 드롭으로만 가능하며, 실수로 클릭 이동되지 않도록 설계되어 있습니다.</li>
          <li>오프셋 프리셋(트랙스로지스 / 쇼피 SLS)을 적용한 후, 스케일 모드와 세부 오프셋으로 인쇄 위치를 미세 조정할 수 있습니다.</li>
          <li>“원본 크기 유지” 모드를 사용하면 텍스트/바코드 크기를 거의 그대로 유지하면서 라벨 칸에 배치할 수 있습니다.</li>
          <li>“슬롯 밖으로 튀어나가지 않도록 자동 축소” 옵션을 켜면 라벨 칸을 넘지 않도록 스케일이 자동으로 제한됩니다.</li>
        </ul>
      </div>
    </div>
  </div>
</body>
</html>
